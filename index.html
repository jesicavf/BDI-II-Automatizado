<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BDI-II - Inventario de Depresión de Beck</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h1 { text-align: center; color: #333; }
    .pregunta { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    .datos { margin-bottom: 20px; padding: 10px; background: #e6f2ff; border-radius: 8px; }
    button { padding: 10px 20px; background: #007acc; color: #fff; border: none; border-radius: 6px; cursor: pointer;}
    button:hover { background: #005f99; }
    .autor { position: fixed; bottom: 5px; right: 10px; font-size: 10px; color: #666; }
  </style>
</head>
<body>
<div class="datos">
  <label>Nombre completo: <input type="text" id="nombre" required></label><br><br>
  <label>Fecha de nacimiento: <input type="date" id="fnacimiento" required></label><br>
  <p id="edad"></p>
</div>

<h1>Inventario de Depresión de Beck - II (BDI-II)</h1>
<p><b>Instrucciones:</b> Este cuestionario consta de 21 grupos de afirmaciones. Por favor, 
  lea con atención cada uno de ellos cuidadosamente. Luego elija uno de cada grupo, el que 
  mejor describa el modo como se ha sentido las últimas dos semanas, incluyendo el día de hoy.
  Marque el número correspondiente al enunciado elegido. Si varios enunciados de un mismo grupo le 
  parecen igualmente apropiados, marque el número más alto. 
  Verifique que no haya elegido más de uno por grupo, incluyendo el ítem 16 (cambios en los hábitos de Sueño) y el ítem 18 (cambios en el apetito).</p>

<form id="bdiForm"></form>
<button type="button" onclick="generarPDF()">Descargar Informe PDF</button>

<div class="autor">Autoría Jésica Favara</div>

<script>
const preguntas = [
  "Tristeza", "Pesimismo", "Fracaso", "Pérdida de Placer", "Sentimientos de Culpa",
  "Sentimientos de Castigo", "Disconformidad con uno mismo", "Autocrítica", "Pensamientos o Deseos Suicidas",
  "Llanto", "Agitación", "Pérdida de Interés", "Indecisión", "Desvalorización",
  "Pérdida de Energía", "Cambios en los Hábitos de Sueño", "Irritabilidad",
  "Cambios en el Apetito", "Dificultad de Concentración", "Cansancio o Fatiga",
  "Pérdida de Interés en el Sexo"
];

const opciones = [
  ["0. No me siento triste.","1. Me siento triste gran parte del tiempo","2. Me siento triste todo el tiempo","3. Me siento tan triste o soy tan infeliz que no puedo soportarlo"],
  ["0. No estoy desalentado respecto de mi futuro","1. Me siento más desalentado respecto del futuro que lo habitual","2. No espero que las cosas funcionen para mí","3. Siento que no hay esperanza para mi futuro y solo puede empeorar"],
  ["0. No me siento como un fracasado","1. He fracasado más de lo que hubiera debido","2. Cuando miro hacia atrás veo muchos fracasos","3. Siento que como persona soy un fracaso total"],
  ["0. Obtengo tanto placer como siempre","1. No disfruto tanto de las cosas como antes","2. Obtengo muy poco placer","3. No puedo obtener ningún placer"],
  ["0. No me siento particularmente culpable","1. Me siento culpable por varias cosas","2. Me siento bastante culpable la mayor parte del tiempo","3. Me siento culpable todo el tiempo"],
  ["0. No siento que esté siendo castigado","1. Siento que tal vez pueda ser castigado","2. Espero ser castigado","3. Siento que estoy siendo castigado"],
  ["0. Siento acerca de mi lo mismo que siempre","1. He perdido la confianza en mí mismo","2. Estoy decepcionado conmigo mismo","3. No me gusto a mí mismo"],
  ["0. No me critico ni me culpo más de lo habitual","1. Estoy más crítico conmigo mismo","2. Me critico por todos mis errores","3. Me culpo por todo lo malo que sucede"],
  ["0. No tengo pensamientos de matarme","1. He tenido pensamientos pero no lo haría","2. Querría matarme","3. Me mataría si tuviera oportunidad"],
  ["0. No lloro más de lo habitual","1. Lloro más de lo habitual","2. Lloro por cualquier pequeñez","3. Siento ganas de llorar pero no puedo"],
  ["0. No estoy más inquieto que lo habitual","1. Me siento más inquieto","2. Estoy tan inquieto que me es difícil quedarme quieto","3. Debo estar siempre en movimiento"],
  ["0. No he perdido interés en actividades o personas","1. Estoy menos interesado","2. He perdido casi todo interés","3. Me es difícil interesarme por algo"],
  ["0. Tomo decisiones tan bien como siempre","1. Me resulta más difícil","2. Encuentro mucha más dificultad","3. Tengo problemas para tomar cualquier decisión"],
  ["0. No siento que no sea valioso","1. No me considero tan valioso como antes","2. Me siento menos valioso que otros","3. Siento que no valgo nada"],
  ["0. Tengo tanta energía como siempre","1. Tengo menos energía que antes","2. No tengo suficiente energía para hacer demasiado","3. No tengo energía suficiente para hacer nada"],
  ["0. No he experimentado cambios","1a. Duermo un poco más que lo habitual","1b. Duermo un poco menos que lo habitual",
   "2a. Duermo mucho más que lo habitual","2b. Duermo mucho menos que lo habitual",
   "3a. Duermo la mayor parte del día","3b. Me despierto 1-2 horas más temprano y no puedo volver a dormirme"],
  ["0. No estoy más irritable","1. Estoy más irritable que lo habitual","2. Estoy mucho más irritable","3. Estoy irritable todo el tiempo"],
  ["0. No he experimentado cambios","1a. Mi apetito es un poco menor que lo habitual","1b. Mi apetito es un poco mayor que lo habitual",
   "2a. Mi apetito es mucho menor que antes","2b. Mi apetito es mucho mayor que antes",
   "3a. No tengo apetito en absoluto","3b. Quiero comer todo el día"],
  ["0. Puedo concentrarme tan bien como siempre","1. No puedo concentrarme tan bien","2. Me es difícil mantener la mente","3. Encuentro que no puedo concentrarme en nada"],
  ["0. No estoy más cansado que lo habitual","1. Me fatigo más","2. Estoy demasiado fatigado para muchas cosas","3. Estoy demasiado fatigado para la mayoría de las cosas"],
  ["0. No he notado cambios en el interés por el sexo","1. Estoy menos interesado","2. Estoy mucho menos interesado","3. He perdido completamente el interés en el sexo"]
];

// Generar preguntas en formulario
const form = document.getElementById("bdiForm");
preguntas.forEach((p, i) => {
  const div = document.createElement("div");
  div.classList.add("pregunta");
  div.innerHTML = `<b>${i+1}. ${p}</b><br>`;
  opciones[i].forEach((op, j) => {
    div.innerHTML += `<label><input type="radio" name="p${i}" value="${j}" required> ${op}</label><br>`;
  });
  form.appendChild(div);
});

// Calcular edad
document.getElementById("fnacimiento").addEventListener("change",()=>{
  const fn = new Date(document.getElementById("fnacimiento").value);
  const hoy = new Date();
  let edad = hoy.getFullYear() - fn.getFullYear();
  if(hoy.getMonth()<fn.getMonth() || (hoy.getMonth()===fn.getMonth() && hoy.getDate()<fn.getDate())) edad--;
  document.getElementById("edad").textContent = "Edad: "+edad+" años";
});

// Función PDF con diseño
function generarPDF() {
  const nombre = document.getElementById("nombre").value.trim();
  const fnacimiento = document.getElementById("fnacimiento").value;
  if(!nombre || !fnacimiento){ alert("Complete nombre y fecha de nacimiento"); return; }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","mm","a4");
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const margen = 10;
  let y = margen;
  let puntaje = 0;
  let ideacionSuicida = false;
  const fechaAdmin = new Date().toLocaleDateString();

  // Encabezado azul
  doc.setFillColor(0, 102, 204);
  doc.rect(0, 0, pageWidth, 15, 'F');
  doc.setFontSize(14);
  doc.setTextColor(255,255,255);
  doc.text("Inventario de Depresión de Beck - II (BDI-II)", pageWidth/2, 11, {align: "center"});
  y += 20;

  doc.setFontSize(12);
  doc.setTextColor(0, 0, 0);

  function escribirTexto(texto, sombreado=false) {
    const lineas = doc.splitTextToSize(texto, pageWidth - 2*margen);
    lineas.forEach(linea => {
      if(y>pageHeight-margen) { doc.addPage(); y=margen; }
      if(sombreado) {
        const altura = 7;
        doc.setFillColor(230,230,250);
        doc.rect(margen-2, y-5, pageWidth-2*margen+4, altura, 'F');
      }
      doc.text(linea, margen, y);
      y += 7;
    });
  }

  escribirTexto(`Nombre: ${nombre}`, true);
  escribirTexto(`Fecha de nacimiento: ${fnacimiento}`, true);
  escribirTexto(`Fecha de administración: ${fechaAdmin}`, true);
  y += 3;
  escribirTexto("Respuestas seleccionadas:", true);

  for(let i=0;i<preguntas.length;i++){
    const sel = document.querySelector(`input[name="p${i}"]:checked`);
    if(!sel){ alert("Complete todas las preguntas"); return; }
    const valor = parseInt(sel.value);
    puntaje += valor;
    if(i===8 && valor>0) ideacionSuicida = true;
    escribirTexto(`${i+1}. ${preguntas[i]} -> ${opciones[i][valor]}`, true);
  }

  let interpretacion="", resumen="";
  if(puntaje<=13){
    interpretacion="Mínima depresión";
    resumen="No se observan síntomas depresivos clínicamente significativos.";
  } else if(puntaje<=19){
    interpretacion="Depresión leve";
    resumen="Presenta síntomas leves de depresión; se recomienda seguimiento y estrategias de afrontamiento.";
  } else if(puntaje<=28){
    interpretacion="Depresión moderada";
    resumen="Se observan síntomas moderados de depresión; se sugiere intervención psicológica y evaluación adicional.";
  } else {
    interpretacion="Depresión grave";
    resumen="Se observan síntomas graves de depresión; se recomienda evaluación clínica urgente y posible tratamiento integral.";
  }

  y += 3;
  escribirTexto(`Puntaje Directo: ${puntaje}`, true);
  escribirTexto(`Interpretación: ${interpretacion}`, true);
  escribirTexto(`Resumen: ${resumen}`, true);
  if(ideacionSuicida) escribirTexto("ALERTA: Se detecta ideación suicida. Evaluar con prioridad clínica.", true);

  // Leyenda profesional en rojo
  y += 5;
  doc.setFontSize(10);
  doc.setTextColor(150, 0, 0);
  escribirTexto("Este informe no reemplaza una evaluación integral realizada por un profesional competente.", true);
  doc.setTextColor(0, 0, 0);
  doc.setFontSize(12);

  // Autoría al pie
  doc.setTextColor(100,100,100);
  doc.text("Autoría: Jésica Favara", pageWidth-60, pageHeight-10);

  const nombreArchivo = `${nombre.replace(/ /g,"_")}_${fechaAdmin.replace(/\//g,"-")}_BDI-II.pdf`;
  doc.save(nombreArchivo);
}
</script>
</body>
</html>
