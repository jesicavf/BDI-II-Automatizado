<!-- Guarda este archivo como bdi.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evaluación BDI-II</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f9;
      margin: 20px;
      color: #333;
    }
    h1, h2 {
      text-align: center;
      color: #2c3e50;
    }
    .question {
      background: #fff;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .result {
      margin-top: 30px;
      padding: 20px;
      border-radius: 10px;
      background: #ecf0f1;
    }
    .pdf-report {
      padding: 30px;
      font-family: 'Segoe UI', Tahoma, sans-serif;
    }
    .pdf-report h2 {
      color: #34495e;
      border-bottom: 2px solid #3498db;
      padding-bottom: 5px;
    }
    .pdf-report table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .pdf-report table th, .pdf-report table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    .pdf-report table th {
      background-color: #3498db;
      color: white;
    }
    .highlight {
      color: #e74c3c;
      font-weight: bold;
    }
    .footer-note {
      margin-top: 20px;
      font-size: 12px;
      text-align: center;
      color: #7f8c8d;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
  </style>
</head>
<body>
  <h1>Inventario de Depresión de Beck (BDI-II)</h1>
  <form id="bdi-form">
    <label>Nombre: <input type="text" id="nombre" required></label><br><br>
    <label>Fecha de nacimiento: <input type="date" id="fecha-nacimiento" required></label><br><br>
    
    <div id="questions"></div>
    <button type="submit">Finalizar y generar informe</button>
  </form>

  <div id="result" class="result" style="display:none;"></div>

  <script>
    const questions = [
      "Tristeza","Pesimismo","Fracaso","Pérdida de Placer","Sentimientos de Culpa","Sentimientos de Castigo",
      "Disconformidad con uno mismo","Autocrítica","Ideación suicida","Llanto","Agitación","Pérdida de interés",
      "Indecisión","Desvalorización","Pérdida de Energía","Cambios en los hábitos de sueño","Irritabilidad",
      "Cambios en el apetito","Dificultad de concentración","Cansancio o fatiga","Pérdida de interés en el sexo"
    ];

    const options = [
      "0 - No me siento triste.",
      "1 - Me siento triste gran parte del tiempo.",
      "2 - Me siento triste todo el tiempo.",
      "3 - Me siento tan triste o infeliz que no puedo soportarlo."
    ];

    const container = document.getElementById("questions");

    questions.forEach((q, i) => {
      const div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `<h3>${i+1}. ${q}</h3>` + options.map((opt, idx) =>
        `<label><input type="radio" name="q${i}" value="${idx}" required> ${opt}</label><br>`
      ).join("");
      container.appendChild(div);
    });

    document.getElementById("bdi-form").addEventListener("submit", function(e){
      e.preventDefault();

      const nombre = document.getElementById("nombre").value;
      const fecha = document.getElementById("fecha-nacimiento").value;

      let total = 0;
      let respuestas = [];

      questions.forEach((q, i) => {
        const val = parseInt(document.querySelector(`input[name="q${i}"]:checked`).value);
        total += val;
        respuestas.push({ pregunta: q, puntaje: val });
      });

      // Ordenar de mayor a menor
      respuestas.sort((a,b) => b.puntaje - a.puntaje);

      let nivel = "";
      if (total < 14) nivel = "Depresión mínima";
      else if (total < 20) nivel = "Depresión leve";
      else if (total < 29) nivel = "Depresión moderada";
      else nivel = "Depresión grave";

      let ideacion = respuestas.find(r => r.pregunta === "Ideación suicida" && r.puntaje > 0);

      const resultDiv = document.getElementById("result");
      resultDiv.style.display = "block";
      resultDiv.innerHTML = `<h2>Resultados</h2>
        <p><b>Total:</b> ${total} puntos</p>
        <p><b>Nivel:</b> ${nivel}</p>
        ${ideacion ? `<p class="highlight">⚠ Atención: El paciente refiere ideación suicida.</p>` : ""}
        <button onclick="generarPDF('${nombre}','${fecha}',${total},'${nivel}',${ideacion ? true : false})">Descargar Informe PDF</button>`;
    });

    function generarPDF(nombre, fecha, total, nivel, ideacion) {
      const respuestasOrdenadas = questions.map((q, i) => {
        const val = parseInt(document.querySelector(`input[name="q${i}"]:checked`).value);
        return { pregunta: q, puntaje: val };
      }).sort((a,b) => b.puntaje - a.puntaje);

      let tabla = "<table><tr><th>Pregunta</th><th>Puntaje</th></tr>";
      respuestasOrdenadas.forEach(r => {
        tabla += `<tr><td>${r.pregunta}</td><td>${r.puntaje}</td></tr>`;
      });
      tabla += "</table>";

      const element = document.createElement("div");
      element.className = "pdf-report";
      element.innerHTML = `
        <h2>Informe BDI-II</h2>
        <p><b>Nombre:</b> ${nombre}</p>
        <p><b>Fecha de nacimiento:</b> ${fecha}</p>
        <p><b>Puntaje total:</b> ${total}</p>
        <p><b>Nivel de depresión:</b> ${nivel}</p>
        ${ideacion ? `<p class="highlight">⚠ El paciente refiere ideación suicida.</p>` : ""}
        <h3>Detalle de respuestas</h3>
        ${tabla}
        <div class="footer-note">
          ⚠ Este informe es orientativo y no reemplaza una evaluación exhaustiva supervisada por un profesional de la salud mental.
        </div>
      `;

      html2pdf().set({
        margin: 1,
        filename: `Informe_BDI_${nombre}.pdf`,
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'cm', format: 'a4', orientation: 'portrait' }
      }).from(element).save();
    }
  </script>
</body>
</html>
