<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BDI-II - Inventario de Depresi√≥n de Beck</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h1 { text-align: center; color: #333; }
    .pregunta { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    .datos { margin-bottom: 20px; padding: 10px; background: #e6f2ff; border-radius: 8px; }
    button { padding: 10px 20px; background: #007acc; color: #fff; border: none; border-radius: 6px; cursor: pointer;}
    button:hover { background: #005f99; }
    .autor { position: fixed; bottom: 5px; right: 10px; font-size: 10px; color: #666; }
  </style>
</head>
<body>
<div class="datos">
  <label>Nombre completo: <input type="text" id="nombre" required></label><br><br>
  <label>Fecha de nacimiento: <input type="date" id="fnacimiento" required></label><br>
  <p id="edad"></p>
</div>

<h1>Inventario de Depresi√≥n de Beck - II (BDI-II)</h1>
<p><b>Instrucciones:</b> Este cuestionario consta de 21 grupos de afirmaciones. Por favor, 
  lea con atenci√≥n cada uno de ellos cuidadosamente. Luego elija uno de cada grupo, el que 
  mejor describa el modo como se ha sentido las √∫ltimas dos semanas, incluyendo el d√≠a de hoy.
  Marque el n√∫mero correspondiente al enunciado elegido. Si varios enunciados de un mismo grupo le 
  parecen igualmente apropiados, marque el n√∫mero m√°s alto. 
  Verifique que no haya elegido m√°s de uno por grupo, incluyendo el √≠tem 16 (cambios en los h√°bitos de Sue√±o) y el √≠tem 18 (cambios en el apetito).</p>

<form id="bdiForm"></form>
<button type="button" onclick="generarPDF()">Descargar Informe PDF</button>

<div class="autor">"Beck Depression Inventory (Second edition) Adaptaci√≥n argentina: Dra. Mar√≠a Elena Brenlla. Versi√≥n digital: Mag. J√©sica Favara"</div>

<script>
const preguntas = [
  "Tristeza", "Pesimismo", "Fracaso", "P√©rdida de Placer", "Sentimientos de Culpa",
  "Sentimientos de Castigo", "Disconformidad con uno mismo", "Autocr√≠tica", "Pensamientos o Deseos Suicidas",
  "Llanto", "Agitaci√≥n", "P√©rdida de Inter√©s", "Indecisi√≥n", "Desvalorizaci√≥n",
  "P√©rdida de Energ√≠a", "Cambios en los H√°bitos de Sue√±o", "Irritabilidad",
  "Cambios en el Apetito", "Dificultad de Concentraci√≥n", "Cansancio o Fatiga",
  "P√©rdida de Inter√©s en el Sexo"
];

const opciones = [
 ["0. No me siento triste.","1. Me siento triste gran parte del tiempo","2. Estoy triste todo el tiempo","3. Estoy tan triste o soy tan infeliz que no puedo soportarlo"],
  ["0. No estoy desalentado/a respecto de mi futuro","1. Me siento m√°s desalentado/a respecto de mi futuro que lo que sol√≠a estarlo","2. No espero que las cosas funcionen para m√≠","3. Siento que no hay esperanza para mi futuro y que s√≥lo puede empeorar"],
  ["0. No me siento como un fracasado/a","1. He fracasado m√°s de lo que hubiera debido","2. Cuando miro hacia atr√°s veo muchos fracasos","3. Siento que como persona soy un fracaso total"],
  ["0. Obtengo tanto placer como siempre por las cosas de las que disfruto","1. No disfruto tanto de las cosas como sol√≠a hacerlo","2. Obtengo muy poco placer de las cosas que sol√≠a disfrutar","3. No puedo obtener ning√∫n placer de las cosas de las que sol√≠a disfrutar"],
  ["0. No me siento particularmente culpable","1. Me siento culpable respecto de varias cosas que he hecho o que deber√≠a haber hecho","2. Me siento bastante culpable la mayor parte del tiempo","3. Me siento culpable todo el tiempo"],
  ["0. No siento que est√© siendo castigado/a","1. Siento que tal vez pueda ser castigado/a","2. Espero ser castigado/a","3. Siento que estoy siendo castigado/a"],
  ["0. Siento acerca de mi lo mismo/a que siempre","1. He perdido la confianza en m√≠ mismo/a","2. Estoy decepcionado/a conmigo mismo/a","3. No me gusto a m√≠ mismo/a"],
  ["0. No me critico ni me culpo m√°s de lo habitual","1. Estoy m√°s cr√≠tico/a conmigo mismo/a de lo que sol√≠a estarlo","2. Me critico a m√≠ mismo/a por todos mis errores","3. Me culpo a m√≠ mismo/a por todo lo malo que sucede"],
  ["0. No tengo ning√∫n pensamiento de matarme","1. He tenido pensamientos de matarme, pero no lo har√≠a","2. Querr√≠a matarme","3. Me matar√≠a si tuviera la oportunidad de hacerlo"],
  ["0. No lloro m√°s de lo que sol√≠a hacerlo","1. Lloro m√°s de lo que sol√≠a hacerlo","2. Lloro por cualquier peque√±ez","3. Siento ganas de llorar pero no puedo"],
  ["0. No estoy m√°s inquieto/a o tenso/a que lo habitual","1. Me siento m√°s inquieto/a o tenso/a que lo habitual","2. Estoy tan inquieto/a o agitado/a que me es dif√≠cil quedarme quieto/a","3. Estoy tan inquieto/a o agitado/a que tengo que estar siempre en movimiento o haciendo algo"],
  ["0. No he perdido el inter√©s en otras actividades o personas","1. Estoy menos interesado/a que antes en otras personas o cosas","2. He perdido casi todo el inter√©s en otras personas o cosas","3. Me es dif√≠cil interesarme por algo"],
  ["0. Tomo mis propias decisiones tan bien como siempre","1. Me resulta m√°s dif√≠cil que de costumbre tomar decisiones","2. Encuentro mucha m√°s dificultad que antes para tomar decisiones","3. Tengo problemas para tomar cualquier decisi√≥n"],
  ["0. No siento que yo no sea valioso/a","1. No me considero a mi mismo/a tan valioso/a y √∫til como sol√≠a considerarme","2. Me siento menos valioso/a cuando me comparo con otros","3. Siento que no valgo nada"],
  ["0. Tengo tanta energ√≠a como siempre","1. Tengo menos energ√≠a que la que sol√≠a tener","2. No tengo suficiente energ√≠a para hacer demasiado","3. No tengo energ√≠a suficiente para hacer nada"],
  ["0. No he experimentado ning√∫n cambio en mis h√°bitos de sue√±o","1a. Duermo un poco m√°s que lo habitual","1b. Duermo un poco menos que lo habitual",
   "2a. Duermo mucho m√°s que lo habitual","2b. Duermo mucho menos que lo habitual",
   "3a. Duermo la mayor parte del d√≠a","3b. Me despierto 1-2 horas m√°s temprano y no puedo volver a dormirme"],
  ["0. No estoy m√°s irritable que lo habitual","1. Estoy m√°s irritable que lo habitual","2. Estoy mucho m√°s irritable que lo habitual","3. Estoy irritable todo el tiempo"],
  ["0. No he experimentado ning√∫n cambio en mi apetito","1a. Mi apetito es un poco menor que lo habitual","1b. Mi apetito es un poco mayor que lo habitual",
   "2a. Mi apetito es mucho menor que antes","2b. Mi apetito es mucho mayor que lo habitual",
   "3a. No tengo apetito en absoluto","3b. Quiero comer todo el d√≠a"],
  ["0. Puedo concentrarme tan bien como siempre","1. No puedo concentrarme tan bien como habitualmente","2. Me es dif√≠cil mantener la mente en algo por mucho tiempo","3. Encuentro que no puedo concentrarme en nada"],
  ["0. No estoy m√°s cansado/a o fatigado/a que lo habitual","1. Me fatigo o me canso m√°s f√°cilmente que lo habitual","2. Estoy demasiado fatigado/a o cansado/a para hacer muchas de las cosas que sol√≠a hacer","3. Estoy demasiado fatigado/a o cansado/a para hacer la mayor√≠a de las cosas que sol√≠a hacer"],
  ["0. No he notado ning√∫n cambio reciente en mi inter√©s por el sexo","1. Estoy menos interesado/a en el sexo de lo que sol√≠a estarlo","2. Estoy mucho menos interesado/a en el sexo","3. He perdido completamente el inter√©s en el sexo"]
];



// Generar preguntas en formulario
const form = document.getElementById("bdiForm");
preguntas.forEach((p, i) => {
  const div = document.createElement("div");
  div.classList.add("pregunta");
  div.innerHTML = `<b>${i+1}. ${p}</b><br>`;
  opciones[i].forEach((op, j) => {
    div.innerHTML += `<label><input type="radio" name="p${i}" value="${j}" required> ${op}</label><br>`;
  });
  form.appendChild(div);
});

// Calcular edad
document.getElementById("fnacimiento").addEventListener("change",()=>{
  const fn = new Date(document.getElementById("fnacimiento").value);
  const hoy = new Date();
  let edad = hoy.getFullYear() - fn.getFullYear();
  if(hoy.getMonth()<fn.getMonth() || (hoy.getMonth()===fn.getMonth() && hoy.getDate()<fn.getDate())) edad--;
  document.getElementById("edad").textContent = "Edad: "+edad+" a√±os";
});

// Funci√≥n PDF con dise√±o
<script>
function generarPDF() {
  let valido = true;  // asumimos que est√° todo bien

  // üî¥ Paso 1: validar todas las respuestas
  if(!validarFormulario()) return;  

  // üî¥ Paso 2: validar nombre
  const nombreInput = document.getElementById("nombre");
  if(nombreInput.value.trim() === ""){
    nombreInput.style.border = "2px solid red";  // borde rojo
    valido = false;
  } else {
    nombreInput.style.border = "";  // se limpia si est√° bien
  }

  // üî¥ Paso 3: validar fecha de nacimiento
  const fnacimientoInput = document.getElementById("fnacimiento");
  if(fnacimientoInput.value.trim() === ""){
    fnacimientoInput.style.border = "2px solid red";
    valido = false;
  } else {
    fnacimientoInput.style.border = "";
  }

  // üî¥ Si algo est√° mal, no sigue
  if(!valido){
    alert("Complete los campos en rojo antes de continuar.");
    return;
  }

  // ‚úÖ Si pasa todas las validaciones, sigue el proceso normal
  alert("Todo completo, se genera el PDF...");
}
</script>


  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","mm","a4");
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const margen = 10;
  let y = margen;
  let puntaje = 0;
  let ideacionSuicida = false;
  const fechaAdmin = new Date().toLocaleDateString();

  // Encabezado azul
  doc.setFillColor(0, 102, 204);
  doc.rect(0, 0, pageWidth, 15, 'F');
  doc.setFontSize(13);
  doc.setTextColor(255,255,255);
  doc.text("Inventario de Depresi√≥n de Beck - II (BDI-II)", pageWidth/2, 11, {align: "center"});
  y += 20;

  doc.setFontSize(10);
  doc.setTextColor(0, 0, 0);

  function escribirTexto(texto, sombreado=false) {
    const lineas = doc.splitTextToSize(texto, pageWidth - 2*margen);
    lineas.forEach(linea => {
      if(y>pageHeight-margen) { doc.addPage(); y=margen; }
      if(sombreado) {
        const altura = 7;
        doc.setFillColor(230,230,250);
        doc.rect(margen-2, y-5, pageWidth-2*margen+4, altura, 'F');
      }
      doc.text(linea, margen, y);
      y += 7;
    });
  }

  escribirTexto(`Nombre: ${nombre}`, true);
  escribirTexto(`Fecha de nacimiento: ${fnacimiento}`, true);
  escribirTexto(`Fecha de administraci√≥n: ${fechaAdmin}`, true);
  y += 3;
  escribirTexto("Respuestas seleccionadas (ordenadas de mayor puntuaci√≥n a menor puntuaci√≥n):", true);

  // --- Reordenar preguntas por valor antes de imprimir ---
const respuestasOrdenadas = [[],[],[],[]]; // √≠ndice 3 = valor 3, 2 = valor 2, etc.

for(let i=0;i<preguntas.length;i++){
  const sel = document.querySelector(`input[name="p${i}"]:checked`);
  if(!sel){ alert("Complete todas las preguntas"); return; }
  const valor = parseInt(sel.value);
  puntaje += valor;
  if(i===8 && valor>0) ideacionSuicida = true;

  respuestasOrdenadas[valor].push({
    numero: i+1,
    pregunta: preguntas[i],
    respuesta: opciones[i][valor]
  });
}

// Imprimir respuestas ordenadas con subt√≠tulos diferenciados
const titulos = {
  3: "Respuestas con valor 3 (m√°xima intensidad):",
  2: "Respuestas con valor 2:",
  1: "Respuestas con valor 1:",
  0: "Respuestas con valor 0:"
};

for(let valor=3; valor>=0; valor--){
  if(respuestasOrdenadas[valor].length > 0){
    // --- Subt√≠tulo en negrita y un poco m√°s grande ---
    doc.setFont("helvetica", "bold");
    doc.setFontSize(11);
    escribirTexto(titulos[valor], false);

    // --- Volvemos al estilo normal para las respuestas ---
    doc.setFont("helvetica", "normal");
    doc.setFontSize(10);

    respuestasOrdenadas[valor].forEach(item => {
      escribirTexto(`${item.numero}. ${item.pregunta} -> ${item.respuesta}`, true);
    });
  }
}



  let interpretacion="", resumen="";
  if(puntaje<=13){
    interpretacion="M√≠nima depresi√≥n";
    resumen="La puntuaci√≥n obtenida sugiere ausencia o m√≠nima presencia de s√≠ntomas compatibles con depresi√≥n. Los s√≠ntomas pueden ser leves y estar relacionados con variaciones normales del estado de √°nimo o reacciones a eventos de la vida.";
  } else if(puntaje<=19){
    interpretacion="Depresi√≥n leve";
    resumen="La puntuaci√≥n obtenida sugiere s√≠ntomas compatibles con depresi√≥n persistentes, aunque no necesariamente incapacitantes. Igualmente pueden afectar la calidad de vida del individuo.";
  } else if(puntaje<=28){
    interpretacion="Depresi√≥n moderada";
    resumen="La puntuaci√≥n obtenida sugiere la presencia de varios s√≠ntomas compatibles con depresi√≥n que afectan significativamente las actividades diarias de la persona evaluada.";
  } else {
    interpretacion="Depresi√≥n grave";
    resumen="La puntuaci√≥n obtenida sugiere alta intensidad de s√≠ntomas compatibles con depresi√≥n. Las personas con estos puntajes pueden estar experimentando un gran malestar y deterioro funcional. Se recomienda evaluaci√≥n cl√≠nica urgente y posible tratamiento integral.";
  }

  y += 3;
  escribirTexto(`Puntaje Directo: ${puntaje}`, true);
  escribirTexto(`Interpretaci√≥n: ${interpretacion}`, true);
  escribirTexto(`Resumen: ${resumen}`, true);
  if(ideacionSuicida) escribirTexto("ALERTA: Se detecta ideaci√≥n suicida. Evaluar con prioridad cl√≠nica.", true);

  // Leyenda profesional en rojo
  y += 5;
  doc.setFontSize(6);
  doc.setTextColor(150, 0, 0);
  escribirTexto("Aviso importante: Este cuestionario es una herramienta de autoevaluaci√≥n con fines informativos. Sus resultados son orientativos y no constituyen un diagn√≥stico cl√≠nico. La interpretaci√≥n corresponde √∫nicamente a un/a profesional de la salud mental y no reemplaza una evaluaci√≥n psicol√≥gica integral. Ante malestar significativo, se recomienda consultar a un/a psic√≥logo/a o m√©dico/a especializado/a. La adaptaci√≥n del instrumento pertenece a la Dra. Mar√≠a Elena Brenlla y esta versi√≥n se realiza √∫nicamente con findes did√°cticos.", true);
  doc.setTextColor(0, 0, 0);
  doc.setFontSize(6);

  // Autor√≠a al pie
  doc.setFontSize(6);
  doc.setTextColor(100, 100, 100);
  doc.text("Beck Depression Inventory (Second edition) Adaptaci√≥n argentina: Dra. Mar√≠a Elena Brenlla. Versi√≥n digital: Mag. J√©sica Favara", pageWidth - 10, pageHeight - 10, { align: "right" });

  const nombreArchivo = `${nombre.replace(/ /g,"_")}_${fechaAdmin.replace(/\//g,"-")}_BDI-II.pdf`;

  // --- SOLUCI√ìN PARA FIREFOX Y M√ìVILES ---
  const pdfBlob = doc.output("blob");
  const blobUrl = URL.createObjectURL(pdfBlob);
  const a = document.createElement("a");
  a.href = blobUrl;
  a.download = nombreArchivo;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(blobUrl);
}
</script>
</body>
</html>
