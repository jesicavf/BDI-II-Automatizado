<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>BDI-II - Inventario de Depresión de Beck</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
    h1 { text-align: center; color: #333; }
    .pregunta { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    .datos { margin-bottom: 20px; padding: 10px; background: #e6f2ff; border-radius: 8px; }
    button { padding: 10px 20px; background: #007acc; color: #fff; border: none; border-radius: 6px; cursor: pointer;}
    button:hover { background: #005f99; }
    .autor { position: fixed; bottom: 5px; right: 10px; font-size: 10px; color: #666; }
  </style>
</head>
<body>
<div class="datos">
  <label>Nombre completo: <input type="text" id="nombre" required></label><br><br>
  <label>Fecha de nacimiento: <input type="date" id="fnacimiento" required></label><br>
  <p id="edad"></p>
</div>

<h1>Inventario de Depresión de Beck - II (BDI-II)</h1>
<p><b>Instrucciones:</b> Este cuestionario consta de 21 grupos de afirmaciones. Por favor, 
  lea con atención cada uno de ellos cuidadosamente. Luego elija uno de cada grupo, el que 
  mejor describa el modo como se ha sentido las últimas dos semanas, incluyendo el día de hoy.
  Marque el número correspondiente al enunciado elegido. Si varios enunciados de un mismo grupo le 
  parecen igualmente apropiados, marque el número más alto. 
  Verifique que no haya elegido más de uno por grupo, incluyendo el ítem 16 (cambios en los hábitos de Sueño) y el ítem 18 (cambios en el apetito).</p>

<form id="bdiForm"></form>
<button type="button" onclick="generarPDF()">Descargar Informe PDF</button>

<div class="autor">"Beck Depression Inventory (Second edition) Adaptación argentina: Dra. María Elena Brenlla. Versión digital: Mag. Jésica Favara"</div>

<script>
const preguntas = [
  "Tristeza", "Pesimismo", "Fracaso", "Pérdida de Placer", "Sentimientos de Culpa",
  "Sentimientos de Castigo", "Disconformidad con uno mismo", "Autocrítica", "Pensamientos o Deseos Suicidas",
  "Llanto", "Agitación", "Pérdida de Interés", "Indecisión", "Desvalorización",
  "Pérdida de Energía", "Cambios en los Hábitos de Sueño", "Irritabilidad",
  "Cambios en el Apetito", "Dificultad de Concentración", "Cansancio o Fatiga",
  "Pérdida de Interés en el Sexo"
];

const opciones = [
 ["0. No me siento triste.","1. Me siento triste gran parte del tiempo","2. Estoy triste todo el tiempo","3. Estoy tan triste o soy tan infeliz que no puedo soportarlo"],
  ["0. No estoy desalentado/a respecto de mi futuro","1. Me siento más desalentado/a respecto de mi futuro que lo que solía estarlo","2. No espero que las cosas funcionen para mí","3. Siento que no hay esperanza para mi futuro y que sólo puede empeorar"],
  ["0. No me siento como un fracasado/a","1. He fracasado más de lo que hubiera debido","2. Cuando miro hacia atrás veo muchos fracasos","3. Siento que como persona soy un fracaso total"],
  ["0. Obtengo tanto placer como siempre por las cosas de las que disfruto","1. No disfruto tanto de las cosas como solía hacerlo","2. Obtengo muy poco placer de las cosas que solía disfrutar","3. No puedo obtener ningún placer de las cosas de las que solía disfrutar"],
  ["0. No me siento particularmente culpable","1. Me siento culpable respecto de varias cosas que he hecho o que debería haber hecho","2. Me siento bastante culpable la mayor parte del tiempo","3. Me siento culpable todo el tiempo"],
  ["0. No siento que esté siendo castigado/a","1. Siento que tal vez pueda ser castigado/a","2. Espero ser castigado/a","3. Siento que estoy siendo castigado/a"],
  ["0. Siento acerca de mi lo mismo/a que siempre","1. He perdido la confianza en mí mismo/a","2. Estoy decepcionado/a conmigo mismo/a","3. No me gusto a mí mismo/a"],
  ["0. No me critico ni me culpo más de lo habitual","1. Estoy más crítico/a conmigo mismo/a de lo que solía estarlo","2. Me critico a mí mismo/a por todos mis errores","3. Me culpo a mí mismo/a por todo lo malo que sucede"],
  ["0. No tengo ningún pensamiento de matarme","1. He tenido pensamientos de matarme, pero no lo haría","2. Querría matarme","3. Me mataría si tuviera la oportunidad de hacerlo"],
  ["0. No lloro más de lo que solía hacerlo","1. Lloro más de lo que solía hacerlo","2. Lloro por cualquier pequeñez","3. Siento ganas de llorar pero no puedo"],
  ["0. No estoy más inquieto/a o tenso/a que lo habitual","1. Me siento más inquieto/a o tenso/a que lo habitual","2. Estoy tan inquieto/a o agitado/a que me es difícil quedarme quieto/a","3. Estoy tan inquieto/a o agitado/a que tengo que estar siempre en movimiento o haciendo algo"],
  ["0. No he perdido el interés en otras actividades o personas","1. Estoy menos interesado/a que antes en otras personas o cosas","2. He perdido casi todo el interés en otras personas o cosas","3. Me es difícil interesarme por algo"],
  ["0. Tomo mis propias decisiones tan bien como siempre","1. Me resulta más difícil que de costumbre tomar decisiones","2. Encuentro mucha más dificultad que antes para tomar decisiones","3. Tengo problemas para tomar cualquier decisión"],
  ["0. No siento que yo no sea valioso/a","1. No me considero a mi mismo/a tan valioso/a y útil como solía considerarme","2. Me siento menos valioso/a cuando me comparo con otros","3. Siento que no valgo nada"],
  ["0. Tengo tanta energía como siempre","1. Tengo menos energía que la que solía tener","2. No tengo suficiente energía para hacer demasiado","3. No tengo energía suficiente para hacer nada"],
  ["0. No he experimentado ningún cambio en mis hábitos de sueño","1a. Duermo un poco más que lo habitual","1b. Duermo un poco menos que lo habitual",
   "2a. Duermo mucho más que lo habitual","2b. Duermo mucho menos que lo habitual",
   "3a. Duermo la mayor parte del día","3b. Me despierto 1-2 horas más temprano y no puedo volver a dormirme"],
  ["0. No estoy más irritable que lo habitual","1. Estoy más irritable que lo habitual","2. Estoy mucho más irritable que lo habitual","3. Estoy irritable todo el tiempo"],
  ["0. No he experimentado ningún cambio en mi apetito","1a. Mi apetito es un poco menor que lo habitual","1b. Mi apetito es un poco mayor que lo habitual",
   "2a. Mi apetito es mucho menor que antes","2b. Mi apetito es mucho mayor que lo habitual",
   "3a. No tengo apetito en absoluto","3b. Quiero comer todo el día"],
  ["0. Puedo concentrarme tan bien como siempre","1. No puedo concentrarme tan bien como habitualmente","2. Me es difícil mantener la mente en algo por mucho tiempo","3. Encuentro que no puedo concentrarme en nada"],
  ["0. No estoy más cansado/a o fatigado/a que lo habitual","1. Me fatigo o me canso más fácilmente que lo habitual","2. Estoy demasiado fatigado/a o cansado/a para hacer muchas de las cosas que solía hacer","3. Estoy demasiado fatigado/a o cansado/a para hacer la mayoría de las cosas que solía hacer"],
  ["0. No he notado ningún cambio reciente en mi interés por el sexo","1. Estoy menos interesado/a en el sexo de lo que solía estarlo","2. Estoy mucho menos interesado/a en el sexo","3. He perdido completamente el interés en el sexo"]
];



// Generar preguntas en formulario
const form = document.getElementById("bdiForm");
preguntas.forEach((p, i) => {
  const div = document.createElement("div");
  div.classList.add("pregunta");
  div.innerHTML = `<b>${i+1}. ${p}</b><br>`;
  opciones[i].forEach((op, j) => {
    div.innerHTML += `<label><input type="radio" name="p${i}" value="${j}" required> ${op}</label><br>`;
  });
  form.appendChild(div);
});

// Calcular edad
document.getElementById("fnacimiento").addEventListener("change",()=>{
  const fn = new Date(document.getElementById("fnacimiento").value);
  const hoy = new Date();
  let edad = hoy.getFullYear() - fn.getFullYear();
  if(hoy.getMonth()<fn.getMonth() || (hoy.getMonth()===fn.getMonth() && hoy.getDate()<fn.getDate())) edad--;
  document.getElementById("edad").textContent = "Edad: "+edad+" años";
});

// Función PDF con diseño
function generarPDF() {
  const nombre = document.getElementById("nombre").value.trim();
  const fnacimiento = document.getElementById("fnacimiento").value;
  if(!nombre || !fnacimiento){ alert("Complete nombre y fecha de nacimiento"); return; }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","mm","a4");
  const pageWidth = doc.internal.pageSize.getWidth();
  const pageHeight = doc.internal.pageSize.getHeight();
  const margen = 10;
  let y = margen;
  let puntaje = 0;
  let ideacionSuicida = false;
  const fechaAdmin = new Date().toLocaleDateString();

  // Encabezado azul
  doc.setFillColor(0, 102, 204);
  doc.rect(0, 0, pageWidth, 15, 'F');
  doc.setFontSize(13);
  doc.setTextColor(255,255,255);
  doc.text("Inventario de Depresión de Beck - II (BDI-II)", pageWidth/2, 11, {align: "center"});
  y += 20;

  doc.setFontSize(10);
  doc.setTextColor(0, 0, 0);

  function escribirTexto(texto, sombreado=false) {
    const lineas = doc.splitTextToSize(texto, pageWidth - 2*margen);
    lineas.forEach(linea => {
      if(y>pageHeight-margen) { doc.addPage(); y=margen; }
      if(sombreado) {
        const altura = 7;
        doc.setFillColor(230,230,250);
        doc.rect(margen-2, y-5, pageWidth-2*margen+4, altura, 'F');
      }
      doc.text(linea, margen, y);
      y += 7;
    });
  }

  escribirTexto(`Nombre: ${nombre}`, true);
  escribirTexto(`Fecha de nacimiento: ${fnacimiento}`, true);
  escribirTexto(`Fecha de administración: ${fechaAdmin}`, true);
  y += 3;
  escribirTexto("Respuestas seleccionadas (ordenadas de mayor puntuación a menor puntuación):", true);

  // --- Reordenar preguntas por valor antes de imprimir ---
const respuestasOrdenadas = [[],[],[],[]]; // índice 3 = valor 3, 2 = valor 2, etc.

for(let i=0;i<preguntas.length;i++){
  const sel = document.querySelector(`input[name="p${i}"]:checked`);
  if(!sel){ alert("Complete todas las preguntas"); return; }
  const valor = parseInt(sel.value);
  puntaje += valor;
  if(i===8 && valor>0) ideacionSuicida = true;

  respuestasOrdenadas[valor].push({
    numero: i+1,
    pregunta: preguntas[i],
    respuesta: opciones[i][valor]
  });
}

// Imprimir respuestas ordenadas con subtítulos diferenciados
const titulos = {
  3: "Respuestas con valor 3 (máxima intensidad):",
  2: "Respuestas con valor 2:",
  1: "Respuestas con valor 1:",
  0: "Respuestas con valor 0:"
};

for(let valor=3; valor>=0; valor--){
  if(respuestasOrdenadas[valor].length > 0){
    // --- Subtítulo en negrita y un poco más grande ---
    doc.setFont("helvetica", "bold");
    doc.setFontSize(11);
    escribirTexto(titulos[valor], false);

    // --- Volvemos al estilo normal para las respuestas ---
    doc.setFont("helvetica", "normal");
    doc.setFontSize(10);

    respuestasOrdenadas[valor].forEach(item => {
      escribirTexto(`${item.numero}. ${item.pregunta} -> ${item.respuesta}`, true);
    });
  }
}



  let interpretacion="", resumen="";
  if(puntaje<=13){
    interpretacion="Mínima depresión";
    resumen="La puntuación obtenida sugiere ausencia o mínima presencia de síntomas compatibles con depresión. Los síntomas pueden ser leves y estar relacionados con variaciones normales del estado de ánimo o reacciones a eventos de la vida.";
  } else if(puntaje<=19){
    interpretacion="Depresión leve";
    resumen="La puntuación obtenida sugiere síntomas compatibles con depresión persistentes, aunque no necesariamente incapacitantes. Igualmente pueden afectar la calidad de vida del individuo.";
  } else if(puntaje<=28){
    interpretacion="Depresión moderada";
    resumen="La puntuación obtenida sugiere la presencia de varios síntomas compatibles con depresión que afectan significativamente las actividades diarias de la persona evaluada.";
  } else {
    interpretacion="Depresión grave";
    resumen="La puntuación obtenida sugiere alta intensidad de síntomas compatibles con depresión. Las personas con estos puntajes pueden estar experimentando un gran malestar y deterioro funcional. Se recomienda evaluación clínica urgente y posible tratamiento integral.";
  }

  y += 3;
  escribirTexto(`Puntaje Directo: ${puntaje}`, true);
  escribirTexto(`Interpretación: ${interpretacion}`, true);
  escribirTexto(`Resumen: ${resumen}`, true);
  if(ideacionSuicida) escribirTexto("ALERTA: Se detecta ideación suicida. Evaluar con prioridad clínica.", true);

  // Leyenda profesional en rojo
  y += 5;
  doc.setFontSize(6);
  doc.setTextColor(150, 0, 0);
  escribirTexto("Aviso importante: Este cuestionario es una herramienta de autoevaluación con fines informativos. Sus resultados son orientativos y no constituyen un diagnóstico clínico. La interpretación corresponde únicamente a un/a profesional de la salud mental y no reemplaza una evaluación psicológica integral. Ante malestar significativo, se recomienda consultar a un/a psicólogo/a o médico/a especializado/a. La adaptación del instrumento pertenece a la Dra. María Elena Brenlla y esta versión se realiza únicamente con findes didácticos.", true);
  doc.setTextColor(0, 0, 0);
  doc.setFontSize(6);

  // Autoría al pie
  doc.setFontSize(6);
  doc.setTextColor(100, 100, 100);
  doc.text("Beck Depression Inventory (Second edition) Adaptación argentina: Dra. María Elena Brenlla. Versión digital: Mag. Jésica Favara", pageWidth - 10, pageHeight - 10, { align: "right" });

  const nombreArchivo = `${nombre.replace(/ /g,"_")}_${fechaAdmin.replace(/\//g,"-")}_BDI-II.pdf`;

  // --- SOLUCIÓN PARA FIREFOX Y MÓVILES ---
  const pdfBlob = doc.output("blob");
  const blobUrl = URL.createObjectURL(pdfBlob);
  const a = document.createElement("a");
  a.href = blobUrl;
  a.download = nombreArchivo;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(blobUrl);
}
</script>
</body>
</html>
